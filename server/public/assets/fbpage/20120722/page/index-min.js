KISSY.add("utils/build-page",function(a){function c(){var c=b(".fb-build-page"),d=this;c.on("click",function(c){c.preventDefault();var e=b(c.target),f=e.siblings(".status"),g=e.siblings("input");f.html("building...");var h=g.val();a.ajax({url:e.attr("href"),data:{timestamp:h},dataType:"json",success:function(a){if(a.err){var b=a.err;f.html("Error:"+b.message),d.fire("error",{error:a.err});return}f.html("success!"),setTimeout(function(){f.html("")},2e3),a.reports&&d.fire("report",{reports:a.reports})}})})}var b=a.all;return a.extend(c,a.Base),new c}),KISSY.add("utils/calendar-init",function(a,b,c){var d=a.all;return{init:function(e){var f,g=new c.Popup({width:192});g.render();var h=new b(g.get("contentEl"));h.on("select",function(b){this.targetInput&&d(this.targetInput).val(a.Date.format(b.date,"yyyymmdd")),g.hide()}),d(e.triggers).on("click",function(a){clearTimeout(f),g.show();var b=d(a.target);g.align(b,["bl","tl"]),h.targetInput=b}).on("blur",function(a){f=setTimeout(function(){g.hide()},300)})}}},{requires:["calendar","overlay","calendar/assets/base.css"]}),KISSY.add("page/mods/reporter",function(a,b,c,d,e,f,g,h,i,j){var k=a.all,l=function(b){var c=this;c.$el=k(b);if(!c.$el||!c.$el.length)throw new Error("container is not found");a.ready(function(){c.init()})};return a.extend(l,a.Base,{init:function(){var a=this;k("body").delegate("click",".report-plugin-item-hd",function(a){var b=k(a.currentTarget).siblings(".report-plugin-item-bd");b&&b.toggle()})},addError:function(a){var b=this,c=l.error_wrap_tpl.render(a);b.appendReportEl(k(c))},addReport:function(b){var c=this,d={};a.each(b,function(a,b){c.renderer[b]&&a&&(d[b]=c.renderer[b].call(c,a))});var e=l.wrap_tpl.render(d);c.appendReportEl(k(e))},appendReportEl:function(a){var b=this,c=b.$el.all(".report");c.length>0?a.insertBefore(c[0]):a.appendTo(b.$el),a.slideDown(.2)},pluginRenderer:{csslint:"csslint_tpl","kissy-template":"files_tpl",uglifyjs:"files_tpl",cssmin:"files_tpl",concat:"concat_tpl",lesscss:"files_tpl","css-combo":"css_combo_tpl"},parserPluginReports:function(b){return a.map(b,function(a){switch(a.name){case"csslint":a.count=a.lintReport.length;break;case"concat":case"css-combo":a.count=a.jobs.length;break;case"cssmin":case"uglifyjs":case"kissy-template":case"lesscss":a.count=a.files.length}return a})},renderer:{fb:function(a){return l.fb_tpl.render(a)},plugins:function(b){var c=this,d=[];return b=c.parserPluginReports(b),a.each(b,function(a){var b=a.name,e=c.pluginRenderer[b]||null;e&&(e=l[e]);var f=e?e.render(a):"";d.push(l.plugin_tpl.render({name:b,report:a,content:f}))}),d.join("")}}},{fb_tpl:b(c.html),plugin_tpl:b(f.html),wrap_tpl:b(d.html),error_wrap_tpl:b(e.html),csslint_tpl:b(g.html),files_tpl:b(h.html),concat_tpl:b(i.html),css_combo_tpl:b(j.html)}),l},{requires:["template","page/template/report-fb-tpl","page/template/report-wrap-tpl","page/template/report-error-wrap-tpl","page/template/report-plugin-tpl","page/template/report-csslint-tpl","page/template/report-files-tpl","page/template/report-concat-tpl","page/template/report-css-combo-tpl"]}),KISSY.add("page/template/report-fb-tpl",function(){return{html:'<div class="report-fb">\n    <span class="number">\n        {{build_version}}\n    </span>\n    <b class=\'block\'></b><b class=\'triangle\'></b>\n    <span class="number">\n        {{build_timestamp}}\n    </span>\n    <span class="number used-time">\n        {{build_used_time}}ms\n    </span>\n</div>'}}),KISSY.add("page/template/report-wrap-tpl",function(){return{html:'<div class="report" style=\'display:none\'>\n    <div class="report-hd">{{fb}}</div>\n    <div class="report-bd">{{plugins}}</div>\n</div>'}}),KISSY.add("page/template/report-error-wrap-tpl",function(){return{html:'<div class="report" style=\'display:none\'>\n    <div class="report-bd">\n        <div class="alert alert-error">\n            <h2> {{message}} </h2>\n            <h4>error</h4>\n            <pre>{{text}}</pre>\n            <h4>stack</h4>\n            <pre>{{stack}}</pre>\n        </div>\n    </div>\n</div>'}}),KISSY.add("page/template/report-plugin-tpl",function(){return{html:"<div class=\"report-plugin-item\">\n    <div class=\"report-plugin-item-hd{{#if content}} report-plugin-hd-has-content{{/if}}\">\n        <h4>{{name}} \n        {{#if typeof report.count === 'number'}}\n        <span class='plugin-bdg'>\n            <span class=\"badge\">{{report.count}}</span>\n        </span>\n        {{/if}}\n        {{#if typeof report.warningCount === 'number' && report.warningCount > 0}}\n        <span class='plugin-bdg'>\n            <span class=\"badge badge-warning\">{{report.warningCount}}</span>\n        </span>\n        {{/if}}\n        {{#if typeof report.errorCount === 'number' && report.errorCount > 0}}\n        <span class='plugin-bdg'>\n            <span class=\"badge badge-important\">{{report.errorCount}}</span>\n        </span>\n        {{/if}}\n        </h4>\n    </div>\n    {{#if content}}\n    <div class='report-plugin-item-bd'>{{content}}</div>\n    {{/if}}\n    <div class=\"report-plugin-item-ft\">\n        <ul>\n            <li class='used-time'><i class='icon-time'></i> {{report.used_time}} ms\n            </li>\n        </ul>\n    </div>\n</div>"}}),KISSY.add("page/template/report-csslint-tpl",function(){return{html:"<div class=\"csslint-list\">\n    {{#if lintReport&&lintReport.length}}\n        {{#each lintReport as item}}\n            <div class='csslint-list-item'>\n                <h4 class='csslint-file'>{{item.file}}</h4>\n                <p>{{item.fullpath}}</p>\n                <pre>{{item.output}}</pre>\n            </div>\n        {{/each}}\n    {{#else}}\n        \u6ca1\u6709CSS\u6587\u4ef6\n    {{/if}}\n</div>\n"}}),KISSY.add("page/template/report-files-tpl",function(){return{html:'<h4>\u5904\u7406\u6587\u4ef6\u5217\u8868:</h4>\n{{#if !files.length}}\n    <div>\n        \u6ca1\u6709\u6587\u4ef6\n    </div>\n{{#else}}\n    <ul class="plugin-file-list">\n        {{#each files as file}}\n            <li>\n                <i class="icon-file"></i> {{file}}\n            </li>\n        {{/each}}\n    </ul>\n{{/if}}\n'}}),KISSY.add("page/template/report-concat-tpl",function(){return{html:'<h4>\u5904\u7406\u6587\u4ef6\u5217\u8868:</h4>\r\n{{#if !jobs.length}}\r\n    <div>\r\n        \u6ca1\u6709\u6587\u4ef6\r\n    </div>\r\n{{#else}}\r\n    <ul >\r\n        {{#each jobs as job}}\r\n            <li>\r\n                <h4><i class="icon-file"></i> {{job.filename}}</h4>\r\n                <ul class="plugin-file-list">\r\n                    {{#each job.files as file}}\r\n                        <li title=\'{{file.path}}\'>{{file.filename}}</li>\r\n                    {{/each}}\r\n                </ul>\r\n            </li>\r\n        {{/each}}\r\n    </ul>\r\n{{/if}}\r\n'}}),KISSY.add("page/template/report-css-combo-tpl",function(){return{html:'<h4>\u5904\u7406\u6587\u4ef6\u5217\u8868:</h4>\r\n{{#if !jobs.length}}\r\n    <div>\r\n        \u6ca1\u6709\u6587\u4ef6\r\n    </div>\r\n{{#else}}\r\n    <ul >\r\n        {{#each jobs as job}}\r\n            <li>\r\n                <h4><i class="icon-file"></i> {{job.filename}} </h4>\r\n                <ul class="plugin-file-list">\r\n                    {{#each job.imports as file}}\r\n                        <li>\r\n                            <i class="icon-bookmark"></i>  \r\n                            {{file}}\r\n                        </li>\r\n                    {{/each}}\r\n                </ul>\r\n            </li>\r\n        {{/each}}\r\n    </ul>\r\n{{/if}}\r\n'}}),KISSY.add("page/mods/timestamp",function(a){var b=a.all;a.ready(function(){b("body").delegate("click",".build-timestamp",function(a){var c=b(a.target);b(".timestamp-input").val(c.html())})})}),KISSY.add("page/index",function(a,b,c,d){var e=a.all;a.ready(function(){var a=new d("#reports");b.on("report",function(b){a.addReport(b.reports)}),b.on("error",function(b){a.addError(b.error)}),c.init({triggers:"input.timestamp-input"})})},{requires:["utils/build-page","utils/calendar-init","./mods/reporter","./mods/timestamp"]}); 