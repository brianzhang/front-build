KISSY.add("utils/build-page",function(a){function c(){var c=b(".fb-build-page"),d=this;c.on("click",function(c){c.preventDefault();var e=b(c.target),f=e.siblings(".status"),g=e.siblings("input");f.html("building...");var h=g.val();a.ajax({url:e.attr("href"),data:{timestamp:h},dataType:"json",success:function(a){if(a.err){var b=a.err;f.html("Error:"+b.message);return}f.html("success!"),setTimeout(function(){f.html("")},2e3),a.reports&&d.fire("report",{reports:a.reports})}})})}var b=a.all;return a.extend(c,a.Base),new c}),KISSY.add("utils/calendar-init",function(a,b,c){var d=a.all;return{init:function(e){var f=new c.Popup({width:192});f.render();var g=(new b(f.get("contentEl"))).on("select",function(b){this.targetInput&&d(this.targetInput).val(a.Date.format(b.date,"yyyymmdd")),f.hide()});d(e.triggers).on("click",function(a){f.show();var b=d(a.target);f.align(b,["bl","tl"]),g.targetInput=b}),d("body").on("mousedown",function(a){f.get("contentEl").contains(a.target)||f.hide()})}}},{requires:["calendar","overlay","calendar/assets/base.css"]}),KISSY.add("page/mods/reporter",function(a,b,c,d,e,f,g,h,i,j){var k=a.all,l=function(b){var c=this;c.$el=k(b);if(!c.$el||!c.$el.length)throw new Error("container is not found");a.ready(function(){c.init()})};return a.extend(l,a.Base,{init:function(){var a=this;k("body").delegate("click",".report-plugin-item-hd",function(a){var b=k(a.currentTarget).siblings(".report-plugin-item-bd");b&&b.toggle()})},addReport:function(b){var c=this,d={};a.each(b,function(a,b){c.renderer[b]&&a&&(d[b]=c.renderer[b].call(c,a))});var e=l.wrap_tpl.render(d),b=c.$el.all(".report");b.length>0?k(e).insertBefore(b[0]):k(e).appendTo(c.$el)},pluginRenderer:{csslint:"csslint_tpl","kissy-template":"kissy_template_tpl",uglifyjs:"uglifyjs_tpl",cssmin:"cssmin_tpl",concat:"concat_tpl","css-combo":"css_combo_tpl"},pluginReportMapper:function(a){},renderer:{fb:function(a){return l.fb_tpl.render(a)},plugins:function(b){var c=this,d=[];return a.each(b,function(a){var b=a.name,e=c.pluginRenderer[b]||null;e&&(e=l[e]),console.log(c.pluginRenderer),console.log(b,e);var f=e?e.render(a):"";d.push(l.plugin_tpl.render({name:b,report:a,content:f}))}),console.log(d),d.join("")}}},{fb_tpl:b(c.html),plugin_tpl:b(e.html),wrap_tpl:b(d.html),csslint_tpl:b(f.html),kissy_template_tpl:b(g.html),uglifyjs_tpl:b(h.html),cssmin_tpl:b(i.html),concat_tpl:b(j.html),css_combo_tpl:b(i.html)}),l},{requires:["template","page/template/report-fb.tpl","page/template/report-wrap.tpl","page/template/report-plugin.tpl","page/template/report-csslint.tpl","page/template/report-kissy-template.tpl","page/template/report-uglifyjs.tpl","page/template/report-cssmin.tpl","page/template/report-concat.tpl"]}),KISSY.add("page/template/report-fb.tpl",function(){return{html:"<div class=\"report-fb\">\n    <div class=\"row-fluid\">\n        <dl class='span4'>\n            <dt>\u7248\u672c</dt>\n            <dd>{{build_version}}</dd>\n        </dl>\n        <dl class='span4'>\n            <dt>\u6253\u5305\u65f6\u95f4\u6233</dt>\n            <dd>{{build_timestamp}}</dd>\n        </dl>\n        <dl class='span4'>\n            <dt>\u7528\u65f6</dt>\n            <dd>{{build_used_time}}ms</dd>\n        </dl>\n    </div>\n</div>"}}),KISSY.add("page/template/report-wrap.tpl",function(){return{html:'<div class="report">\n    <div class="report-hd">{{fb}}</div>\n    <div class="report-bd">{{plugins}}</div>\n</div>'}}),KISSY.add("page/template/report-plugin.tpl",function(){return{html:'<div class="report-plugin-item">\n    <div class="report-plugin-item-hd{{#if content}} report-plugin-hd-has-content{{/if}}">\n        <h4>{{name}}</h4>\n    </div>\n    {{#if content}}\n    <div class=\'report-plugin-item-bd\'>{{content}}</div>\n    {{/if}}\n    <div class="report-plugin-item-ft">\n        <ul>\n            <li>\u7528\u65f6 {{report.used_time}} ms</li>\n        </ul>\n    </div>\n</div>'}}),KISSY.add("page/template/report-csslint.tpl",function(){return{html:"<div class=\"csslint-list\">\n    {{#if lintReport && lintReport.length}}\n        {{#each lintReport as item}}\n            <div class='csslint-list-item'>\n                <h4 class='csslint-file'>{{item.file}}</h4>\n                <p>{{item.fullpath}}</p>\n                <pre>{{item.output}}</pre>\n            </div>\n        {{/each}}\n    {{#else}}\n        \u6ca1\u6709CSS\u6587\u4ef6\n    {{/if}}\n</div>"}}),KISSY.add("page/template/report-kissy-template.tpl",function(){return{html:'<h4>\u5904\u7406\u6587\u4ef6\u5217\u8868:</h4>\n{{#if !files.length}}\n    <div>\n        \u6ca1\u6709\u6587\u4ef6\n    </div>\n{{#else}}\n    <ul class="plugin-file-list">\n        {{#each files as file}}\n            <li>\n                <i class="icon-file"></i> {{file}}\n            </li>\n        {{/each}}\n    </ul>\n{{/if}}'}}),KISSY.add("page/template/report-uglifyjs.tpl",function(){return{html:'<h4>\u5904\u7406\u6587\u4ef6\u5217\u8868:</h4>\n{{#if !files.length}}\n    <div>\n        \u6ca1\u6709\u6587\u4ef6\n    </div>\n{{#else}}\n    <ul class="plugin-file-list">\n        {{#each files as file}}\n            <li>\n                <i class="icon-file"></i> {{file}}\n            </li>\n        {{/each}}\n    </ul>\n{{/if}}'}}),KISSY.add("page/template/report-cssmin.tpl",function(){return{html:'<h4>\u5904\u7406\u6587\u4ef6\u5217\u8868:</h4>\n{{#if !files.length}}\n    <div>\n        \u6ca1\u6709\u6587\u4ef6\n    </div>\n{{#else}}\n    <ul class="plugin-file-list">\n        {{#each files as file}}\n            <li>\n                <i class="icon-file"></i> {{file}}\n            </li>\n        {{/each}}\n    </ul>\n{{/if}}\n'}}),KISSY.add("page/template/report-concat.tpl",function(){return{html:'<h4>\u5904\u7406\u6587\u4ef6\u5217\u8868:</h4>\r\n{{#if !jobs.length}}\r\n    <div>\r\n        \u6ca1\u6709\u6587\u4ef6\r\n    </div>\r\n{{#else}}\r\n    <ul >\r\n        {{#each jobs as job}}\r\n            <li>\r\n                <h4><i class="icon-file"></i> {{job.filename}}</h4>\r\n                <ul class="plugin-file-list">\r\n                    {{#each job.files as file}}\r\n                        <li title=\'{{file.path}}\'>{{file.filename}}</li>\r\n                    {{/each}}\r\n                </ul>\r\n            </li>\r\n        {{/each}}\r\n    </ul>\r\n{{/if}}\r\n'}}),KISSY.add("page/index",function(a,b,c,d){var e=a.all;a.ready(function(){var a=new d("#reports");b.on("report",function(b){a.addReport(b.reports)}),c.init({triggers:"input.timestamp-input"})})},{requires:["utils/build-page","utils/calendar-init","./mods/reporter"]}); 